:orphan:

.. Auto-generated by mirtk-help-rst from "mirtk deform-mesh -h" output

deform-mesh
===========

.. program:: deform-mesh


Synopsis
--------

::

    mirtk deform-mesh <input> <output> [options]


Description
-----------

.. include:: _descriptions/deform-mesh.rst



Input options
-------------

.. option:: -initial <file>

   Point set used to initialize the deformed output mesh. Usually the output of a
   previous optimization with possibly saved node status (see :option:`-save-status`).
   (default: input)

.. option:: -dof <type> [<dx> [<dy> <dz>]]

   Optimize spatial transformation of named <type> to deform the mesh points.
   The optional <dx>, <dy>, and <dz> arguments specify the control point spacing
   of free-form deformation (FFD) transformations. Common transformation types are:
   
   - ``FFD``:   Cubic B-spline FFD.
   - ``SVFFD``: Stationary velocity (SV) cubic B-spline FFD.

.. option:: -image <file>

   Intensity image on which external forces are based. (default: none)

.. option:: -dmap <file>

   Euclidean distance image on which implicit surface forces are based. (default: none)

.. option:: -dmap-offset <value>

   Implicit surface isovalue in :option:`-dmap` image. (default: 0)

.. option:: -mask <file>

   Mask defining region in which external forces are non-zero. (default: none)

.. option:: -padding <value>

   Padding/Background value of input :option:`-image`. (default: none)


Optimization options
--------------------

.. option:: -optimizer <name>

   Optimization method used to minimize the energy of the deformable surface model:
   
   - ``EulerMethod``:              Forward Euler integration (default)
   - ``EulerMethodWithDamping``:   Forward Euler integration with momentum.
   - ``EulerMethodWithMomentum``:  Forward Euler integration with momentum.
   - ``GradientDescent``:          Gradient descent optimizer.
   - ``ConjugateGradientDescent``: Conjugate gradient descent.

.. option:: -linesearch <name>

   Line search method used by gradient descent optimizers:
   
   - ``Adaptive``: Line search with adaptive step length. (default)
   - ``Brent``: Brent's line search method.

.. option:: -damping <value>

   Damping ratio used by Euler method with momentum modelling the effect
   of dissipation of kinetic energy.

.. option:: -momentum <value>

   Momentum of Euler method with momentum, i.e., :math:`1 - damping` (see :option:`-damping`)

.. option:: -mass <value>

   Node mass used by Euler methods with momentum. (default: 1)

.. option:: -levels <min> [<max>]

   Perform optimization on starting at level <max> until level <min> (> 0).
   On each level, the node forces are averaged :math:`2^{level-1}` times which
   is similar to computing the forces on a coarser mesh. (default: 0 0)

.. option:: -steps | -iterations <n>

   Maximum number of iterations. (default: 100)

.. option:: -step | -dt <value>

   Length of integration/gradient steps. (default: 1)

.. option:: -step-magnification <mag>

   Multiplicative factor for magnification of maximum :option:`-step` length.
   The step length at level n (highest level at n=1) is :math:`dt * mag^{level-1}`. (default: 1)

.. option:: -maxdx <value>

   Maximum displacement of a node at each iteration. By default, the node displacements
   are normalized by the maximum node displacement. When this option is used, the node
   displacements are clamped to the specified maximum length instead. (default: :option:`-step`)

.. option:: -remesh <n>

   Remesh surface mesh every n-th iteration. (default: 0)

.. option:: -minedgelength <value>

   Minimum edge length used for local adaptive remeshing. (default: -1)

.. option:: -maxedgelength <value>

   Maximum edge length used for local adaptive remeshing. (default: -1)

.. option:: -edgelength-magnification <mag>

   Multiplicative factor for magnification of :option:`-minedgelength` and :option:`-maxedgelength`.
   The edge length at level n (highest level at n=1) is :math:`l * mag^{level-1}`. (default: 1)

.. option:: -minangle <degrees>

   Minimum angle between edge node normals for an edge be excluded from collapsing during
   iterative :option:`-remesh` operations. (default: 180)

.. option:: -maxangle <degrees>

   Maximum angle between edge node normals for an edge be excluded from splitting during
   iterative :option:`-remesh` operations. (default: 180)

.. option:: -lowpass <n>

   Low-pass filter surface mesh every n-th iteration. (default: 0)

.. option:: -lowpass-iterations <n>

   Number of :option:`-lowpass` filter iterations. (default: 100)

.. option:: -nointersection

   Hard non-self-intersection constraint for surface meshes. (default: off)

.. option:: -mind | -mindistance <value>

   Minimum distance to other triangles in front of a given triangle.

.. option:: -minw | -minwidth <value>

   Minimum distance to other triangles in the back of a given triangle.

.. option:: -reset-status

   Set status of all mesh nodes to active again after each level (see :option:`-levels`). (default: off)


Deformable model options
------------------------

.. option:: -neighborhood <n>

   Size of node neighborhoods used by internal force terms that consider more
   than only the adjacent nodes, but also up to n-connected nodes. (default: 2)

.. option:: -distance <w>

   Weight of implicit surface distance. (default: 0)

.. option:: -distance-spring | -dspring <w>

   Weight of implicit surface spring force. (default: 0)

.. option:: -distance-measure <name>

   Implicit surface distance measure used by :option:`-distance` and :option:`-distance-spring`):
   
   - ``minimum``: Minimum surface distance (see :option:`-dmap`, default)
   - ``normal``:  Estimate distance by casting rays along normal direction.

.. option:: -balloon-inflation | -balloon <w>

   Weight of inflation force based on local intensity statistics. (default: 0)

.. option:: -balloon-deflation <w>

   Weight of deflation force based on local intensity statistics. (default: 0)

.. option:: -edges <w>

   Weight of image edge force. (default: 0)

.. option:: -inflation <w>

   Weight of surface inflation force used for cortical surface inflation. (default: 0)

.. option:: -bending-energy <w>

   Weight of bending energy of :option:`-dof` transformation. (default: 0)

.. option:: -spring <w>

   Weight of internal spring force. (default: 0)

.. option:: -normal-spring | -nspring <w>

   Weight of internal spring force in normal direction. (default: 0)

.. option:: -tangential-spring | -tspring <w>

   Weight of internal spring force in tangent plane. (default: 0)

.. option:: -normalized-spring <w>

   Weight of internal spring force normalized w.r.t. force in normal direction. (default: 0)

.. option:: -curvature <w>

   Weight of surface curvature. (default: 0)

.. option:: -quadratic-curvature | -qcurvature <w>

   Weight of surface curvature estimated by quadratic fit of node neighbor
   to tangent plane distance. (default: 0)

.. option:: -distortion <w>

   Weight of metric distortion.

.. option:: -stretching <w>

   Weight of spring force based on difference of neighbor distance compared to
   initial distance. (default: 0)

.. option:: -repulsion <w> [<radius>]

   Weight of node repulsion force. (default: 0 0)

.. option:: -collision <w>

   Weight of triangle repulsion force.


Stopping criterion options
--------------------------

.. option:: -extrinsic-energy

   Consider only sum of external energy terms as total energy value of deformable model functional.
   Internal forces still contribute to the gradient of the functional, but are excluded from the
   energy function value (see :option:`-epsilon` and :option:`-minenergy`). (default: off)

.. option:: -epsilon <value>

   Minimum change of deformable surface energy convergence criterion.

.. option:: -delta <value>

   Minimum maximum node displacement or :option:`-dof` parameter value.

.. option:: -minenergy <value>

   Target deformable surface energy value. (default: 0)

.. option:: -minactive <n>

   Minimum percentage of active nodes. (default: 0)

.. option:: -inflation-error <threshold>

   Threshold of surface inflation RMS measure. (default: off)


Output options
--------------

.. option:: -track [<name>]

   Record sum of node displacements along normal direction. The integrated
   displacements are stored in the point data array named "NormalDisplacement"
   by default or with the specified <name>. (default: off)

.. option:: -center-output

   Center output mesh such that center is at origin. (default: off)

.. option:: -match-area

   Scale output mesh by ratio of input and output surface area. (default: off)

.. option:: -match-sampling

   Resample output mesh at corresponding positions of input mesh.
   This option is only useful in conjunction with :option:`-remesh`. (default: off)

.. option:: -save-status

   Save node status (active/passive) to output file. (default: off)

.. option:: -ascii | -nobinary

   Write legacy VTK in ASCII format. (default: off)

.. option:: -binary | -noascii

   Write legacy VTK in binary format. (default: on)

.. option:: -compress, -nocompress

   Write XML VTK file with or without compression. (default: on)

.. option:: -debugprefix <prefix>

   File name prefix for :option:`-debug` output. (default: deform_mesh\_)

.. option:: -debuginterval <n>

   Write :option:`-debug` output every n-th iteration. (default: 10)

.. option:: -levelprefix, -nolevelprefix

   Write :option:`-debug` output without level prefix in file names. (default: on)


Advanced options
----------------

.. option:: -par <name> <value>

   Advanced option to set surface model or optimizer parameter.


Standard options
----------------

.. option:: -v, -verbose [n]

   Increase/Set verbosity of output messages. (default: 1)

.. option:: -debug [level]

   Increase/Set debug level for output of intermediate results. (default: 0)

.. option:: -version [major.minor]

   Print version and exit or set version to emulate.

.. option:: -revision

   Print revision (or version) number only and exit.

.. option:: -h, -help

   Print help and exit.


Terminal options
----------------

.. option:: -color, -nocolor

   Enable/disable colored output. (default: off)


Parallelization options
-----------------------

.. option:: -threads <n>

   Use maximal <n> threads for parallel execution. (default: automatic)
